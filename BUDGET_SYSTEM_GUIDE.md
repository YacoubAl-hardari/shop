# 📊 دليل نظام الميزانية الشخصية

## 🎉 تم إضافة نظام الميزانية الشخصية بنجاح!

تم إضافة نظام متكامل لإدارة الميزانية الشخصية يساعدك على:

-   📈 تتبع إنفاقك الشهري/الأسبوعي/اليومي
-   🏷️ تصنيف مصروفاتك حسب الفئات (بقالة، مطاعم، ملابس، إلخ)
-   ⚠️ الحصول على تنبيهات عند اقتراب أو تجاوز الميزانية
-   📊 عرض إحصائيات وتقارير مفصلة عن إنفاقك

---

## 📁 الملفات التي تم إضافتها

### 1. **Migrations (الجداول)**

-   `create_budgets_table` - جدول الميزانيات الرئيسي
-   `create_budget_categories_table` - جدول فئات الميزانية
-   `create_budget_alerts_table` - جدول التنبيهات
-   `add_budget_category_id_to_user_merchants_table` - ربط التجار بالفئات

### 2. **Models (النماذج)**

-   `Budget` - نموذج الميزانية
-   `BudgetCategory` - نموذج الفئة
-   `BudgetAlert` - نموذج التنبيه

### 3. **Enums (التعدادات)**

-   `BudgetPeriod` - فترة الميزانية (يومي، أسبوعي، شهري، سنوي، مخصص)
-   `BudgetAlertType` - نوع التنبيه (تحذير، خطر، تجاوز، معلومة)

### 4. **Repositories (المستودعات)**

-   `BudgetRepository` - عمليات قاعدة البيانات للميزانيات
-   `BudgetCategoryRepository` - عمليات قاعدة البيانات للفئات

### 5. **Services (الخدمات)**

-   `BudgetService` - منطق الأعمال والتنبيهات

### 6. **Filament Resources**

-   `BudgetResource` - إدارة الميزانيات في لوحة التحكم
-   `BudgetCategoryResource` - إدارة الفئات في لوحة التحكم

### 7. **Widgets (الأدوات)**

-   `BudgetOverviewWidget` - نظرة عامة على الميزانية النشطة
-   `CategorySpendingChartWidget` - رسم بياني للإنفاق حسب الفئة
-   `BudgetAlertsWidget` - عرض التنبيهات

---

## 🚀 كيفية الاستخدام

### الخطوة 1️⃣: إنشاء فئات الميزانية

1. افتح لوحة التحكم
2. اذهب إلى **الميزانية الشخصية** → **فئات الميزانية**
3. اضغط على **إنشاء فئة جديدة**
4. أدخل البيانات:
    - **اسم الفئة**: مثل "بقالة"، "مطاعم"، "ملابس"، "أدوية"
    - **حد الميزانية**: المبلغ المخصص لهذه الفئة (مثل: 1000 ريال)
    - **اللون**: لون لتمييز الفئة في التقارير
    - **الأيقونة**: أيقونة اختيارية
5. احفظ الفئة

> 💡 **نصيحة**: أنشئ فئات تمثل مصروفاتك الرئيسية

### الخطوة 2️⃣: إنشاء ميزانية

1. اذهب إلى **الميزانية الشخصية** → **الميزانيات**
2. اضغط على **إنشاء ميزانية جديدة**
3. أدخل البيانات:
    - **اسم الميزانية**: مثل "ميزانية شهر نوفمبر 2025"
    - **الفترة**: اختر (يومي، أسبوعي، شهري، سنوي، مخصص)
    - **حد الميزانية**: المبلغ الإجمالي (مثل: 5000 ريال)
    - **تاريخ البداية والنهاية**: الفترة الزمنية
    - **نسبة التنبيه**: متى تريد أن تُنبّه (افتراضي: 80%)
    - **نشطة**: فعّل هذا الخيار
4. احفظ الميزانية

### الخطوة 3️⃣: ربط التجار بالفئات

1. اذهب إلى **التجار**
2. اختر تاجر (أو أنشئ جديد)
3. في قسم **فئة الميزانية**، اختر الفئة المناسبة
    - مثال: ربط "البقالة المحلية" بفئة "بقالة"
4. احفظ التغييرات

> 📌 **مهم**: عند ربط التاجر بفئة، ستُحسب جميع مشترياتك من هذا التاجر ضمن الفئة تلقائياً

### الخطوة 4️⃣: تتبع الإنفاق

الآن عند إنشاء طلب جديد:

1. اذهب إلى **الطلبات**
2. أنشئ طلب جديد
3. **تلقائياً** سيقوم النظام بـ:
    - ✅ خصم المبلغ من الميزانية النشطة
    - ✅ خصم المبلغ من فئة التاجر (إذا كان مرتبط بفئة)
    - ✅ إرسال تنبيهات إذا اقتربت أو تجاوزت الحد
    - ✅ تحديث الإحصائيات في الـ Dashboard

---

## 📊 Dashboard (لوحة التحكم)

في الصفحة الرئيسية ستجد:

### 1. **نظرة عامة على الميزانية**

عرض سريع للميزانية النشطة:

-   💰 حد الميزانية
-   📉 المبلغ المصروف
-   💵 المبلغ المتبقي
-   📊 نسبة الإنفاق

### 2. **رسم بياني للإنفاق حسب الفئة**

رسم دائري (Pie Chart) يوضح:

-   توزيع إنفاقك على الفئات المختلفة
-   الفئة الأكثر استهلاكاً للميزانية

### 3. **تنبيهات الميزانية**

قائمة بآخر التنبيهات:

-   ⚠️ تحذيرات الاقتراب من الحد
-   🚨 تنبيهات تجاوز الميزانية
-   يمكنك تمييزها كمقروءة

---

## 🔔 التنبيهات التلقائية

النظام يرسل تنبيهات في الحالات التالية:

### 1. **تنبيه الميزانية الإجمالية**

-   ⚠️ **تحذير** (عند الوصول لـ 80% افتراضياً)
-   🚨 **خطر** (عند الوصول لـ 100%)
-   ❌ **تجاوز** (عند التجاوز)

### 2. **تنبيه الفئة**

-   ⚠️ عند الوصول لـ 80% من ميزانية الفئة
-   🚨 عند تجاوز ميزانية الفئة

### 3. **عرض التنبيهات**

-   في لوحة التحكم (Dashboard)
-   في صفحة التنبيهات
-   إشعارات فورية عند إنشاء طلب

---

## 📝 أمثلة عملية

### مثال 1: ميزانية شهرية بسيطة

```
1. إنشاء ميزانية:
   - الاسم: "ميزانية نوفمبر 2025"
   - الفترة: شهري
   - الحد: 5000 ريال
   - من: 2025-11-01
   - إلى: 2025-11-30

2. إنشاء فئات:
   - بقالة: 2000 ريال
   - مطاعم: 1000 ريال
   - مواصلات: 500 ريال
   - متفرقات: 1500 ريال

3. ربط التجار:
   - "البقالة المحلية" → فئة البقالة
   - "مطعم الشاورما" → فئة المطاعم
   - "سيارة أجرة" → فئة المواصلات
```

### مثال 2: ميزانية أسبوعية للبقالة

```
1. إنشاء ميزانية:
   - الاسم: "بقالة الأسبوع الأول"
   - الفترة: أسبوعي
   - الحد: 500 ريال
   - من: 2025-11-01
   - إلى: 2025-11-07

2. إنشاء فئة:
   - بقالة: 500 ريال

3. عند التسوق:
   - أنشئ طلب من "البقالة المحلية"
   - سيُخصم تلقائياً من الميزانية
```

---

## 🎯 الميزات الرئيسية

### ✅ ما تم تنفيذه:

1. **إدارة الميزانيات**

    - إنشاء/تعديل/حذف ميزانيات
    - دعم فترات مختلفة (يومي، أسبوعي، شهري، سنوي، مخصص)
    - تجديد تلقائي للميزانية (اختياري)

2. **إدارة الفئات**

    - إنشاء فئات بألوان وأيقونات
    - ربط التجار بالفئات
    - تتبع الإنفاق لكل فئة

3. **تتبع تلقائي**

    - يتم خصم الطلبات من الميزانية تلقائياً
    - تحديث الفئات تلقائياً
    - حساب المتبقي والنسب

4. **تنبيهات ذكية**

    - تنبيهات عند الاقتراب من الحد
    - تنبيهات عند التجاوز
    - تنبيهات للفئات أيضاً

5. **تقارير وإحصائيات**
    - Widgets في Dashboard
    - رسوم بيانية
    - عرض الإنفاق حسب الفئة

---

## 🔧 الإعدادات المتقدمة

### تخصيص نسبة التنبيه

يمكنك تعديل نسبة التنبيه لكل ميزانية:

-   افتح الميزانية → تعديل
-   غيّر قيمة **نسبة التنبيه**
-   مثال: 70% للتنبيه المبكر، 90% للتأخير

### التجديد التلقائي

لتفعيل التجديد التلقائي:

1. افتح الميزانية → تعديل
2. فعّل خيار **تجديد تلقائي**
3. عند انتهاء الفترة، سيتم إنشاء ميزانية جديدة تلقائياً

---

## 🛠️ استكشاف الأخطاء

### لا تظهر التنبيهات؟

-   تأكد من وجود ميزانية نشطة
-   تأكد من أن نسبة الإنفاق وصلت للحد المطلوب
-   تحقق من صفحة التنبيهات

### لا يتم خصم الطلبات من الميزانية؟

-   تأكد من وجود ميزانية نشطة في الفترة الحالية
-   تحقق من تاريخ بداية ونهاية الميزانية

### الفئة لا تُحدّث؟

-   تأكد من ربط التاجر بالفئة
-   في صفحة التاجر → فئة الميزانية

---

## 📚 ملاحظات إضافية

### الأمان

-   ✅ كل مستخدم يرى ميزانياته فقط
-   ✅ لا يمكن للمستخدمين رؤية ميزانيات بعضهم
-   ✅ العمليات محمية بـ Transactions

### الأداء

-   ✅ الاستعلامات مُحسّنة
-   ✅ الـ Widgets تُحدّث بشكل دوري
-   ✅ Eager Loading للعلاقات

### قاعدة البيانات

```
budgets
├── id
├── user_id (العميل)
├── name (اسم الميزانية)
├── period (الفترة)
├── total_limit (الحد الكلي)
├── spent_amount (المصروف)
├── remaining_amount (المتبقي)
├── start_date & end_date
├── is_active & auto_renew
└── timestamps

budget_categories
├── id
├── user_id
├── budget_id (اختياري)
├── name (اسم الفئة)
├── budget_limit (حد الفئة)
├── spent_amount (المصروف)
├── color & icon
└── timestamps

budget_alerts
├── id
├── user_id
├── budget_id (اختياري)
├── budget_category_id (اختياري)
├── type (warning/danger/exceeded)
├── title & message
├── trigger_percentage
└── is_read & read_at
```

---

## 🎉 تهانينا!

تم تنفيذ **نظام الميزانية الشخصية** بنجاح! 🎊

الآن يمكنك:

-   📊 إدارة ميزانيتك بكل سهولة
-   🏷️ تصنيف مصروفاتك
-   ⚠️ الحصول على تنبيهات ذكية
-   📈 مراقبة إنفاقك بشكل فعال

---

## 📞 المساعدة

إذا واجهت أي مشكلة أو لديك استفسار:

1. راجع هذا الدليل
2. تحقق من صفحة التنبيهات للرسائل
3. افحص الـ Logs في `storage/logs/laravel.log`

---

**تم التطوير بواسطة**: نظام إدارة الميزانية الشخصية  
**التاريخ**: أكتوبر 2025  
**الإصدار**: 1.0.0
